# DNS Terminologies
- DNS: Domain Name Service
- Domain Registrar: Amazon Route 53, GoDaddy, etc.
- DNS Records: A, AAAA, CNAME, NS, etc.
- Zone File: contains DNS records
- Name Server: Resolves DNS queries (Can be Authoritative or Non-Authoritative)
- Top Level Domain: .com, .gov, .co.uk, etc.
- Second Level Domain: amazon.com, google.com, etc.
![[7.1 URL Breakdown.png]]![[7.2 DNS Breakdown.png]]
# Route 53 Overview
- A highly available, scalable, fully managed and Authoritative DNS
	- Authoritative means the customer (you) can update the DNS records
- Route 53 is also a Domain Registrar
- Provides health check functionality
- Only AWS service which provides 100% availability SLA (Service Level Agreement) (contractually obliged to offer 100% availability)
- 53 is a reference to the traditional DNS port
- A record in Route 53 details how you want to route traffic for a domain
- Each record contains:
	- Domain / Subdomain Name  (example.com)
	- Record Type (A, AAAA)
	- Value (12.34.56.78)
	- Routing Policy (See below)
	- TTL (Time to Live) (Lifespan of a DNS record in client memory)
- Route 53 supports the following DNS record types
	- (Must know) A / AAAA / CNAME / NS
		- A - IPv4
		- AAAA - IPv6
		- CNAME - Canonical Name (Domain Alias)
			- Target must have an A or AAAA record
		- NS - Name Server (Delegates a DNS zone to use given authoritative name servers)
	- (Advanced only) CAA / DS / MX / NAPTR / PTR / SOA / TXT / SPF / SRV
A Hosted Zone is a container for records that define how to route traffic to a domain and its subdomains
- Public Hosted Zones - Routes traffic on the public Internet
- Private Hosted Zones - Routes traffic within one or more VPCs
Hosted Zone charge = $0.50/mo
In this context, "routing" just means a mapping of hostnames to network addresses.
## Public vs Private Hosted Zones
![[7.3 Public vs Private Hosted Zones.png]]
# Route 53 - TTL
TTL (Time To Live) is the value that dictates how long a DNS record is kept in client memory. A higher value would typically be around 24 hours, which is suitable if there is less traffic on Route 53, but brings with it the possibility of the client accessing outdated records. A lower TTL would be something like 60 seconds, which is suitable for high traffic networks, improving their responsiveness to record changes.
TTL is a mandatory value in the DNS record except for Alias records.
# Route 53 - CNAME vs Alias
AWS resources like Load Balancers or CloudFront expose an AWS hostname. A CNAME record points a hostname to any other hostname, it only works for non-root domains. Alias records point a hostname to an AWS resource, they work for both root domain and non root domain. Alias records are also free of charge.
## Alias Records
- Maps a hostname to an AWS resource
- Extension to DNS functionality
- Automatically recognises changes in the resource's IP address
- Can be used for top node of DNS namespace (Zone Apex) e.g. example.com
- Alias records are always of type A / AAAA for AWS resources.
- TTL cannot be set / adjusted
- Possible targets include:
	- ELB
	- CloudFront Distributions
	- API Gateway
	- Elastic Beanstalk environments
	- S3 Websites
	- VPC Interface Endpoints
	- Global Accelerator
	- Other Route 53 record hosted in the same zone
- You cannot set an alias record for an EC2 DNS name
# Route 53 - Health Checks
- HTTP Health Checks are only for public resources
- Health Check => Automated DNS Failover
	- Health checks that monitor an endpoint (Endpoint Monitoring)
	- Health checks that monitor other health checks (Calculated Checks)
	- Health checks that monitor CloudWatch alarms (Better for full control of triggers)
- Endpoint Monitoring
	- About 15 global health checkers will check the endpoint health
	- Healthy / Unhealthy Threshold = 18% (3) by default
	- Interval = 30 seconds (shorter intervals cost more)
	- Supported protocols = HTTP, HTTPS, TCP
	- Health checks only pass when the endpoint returns 2XX and 3XX status codes
	- Health checks can be set up to pass / fail based on the first 5 MiB of the response
	- Configure your router / firewall to allow incoming requests from Route 53 Health Checkers
- Calculated Checks
	- Combine the results of multiple health checks into a single health check
	- Can use the 3 main logic gates (AND, OR, NOT)
	- Can monitor up to 256 child health checks
	- Can specify a pass / fail threshold of child checks
	- Useful if you are performing maintenance on your website and don't want the health checks to fail
- Private Hosted Zones
	- Route 53 checkers are outside of VPCs
	- They cannot access private endpoints (either VPCs or on-site resources)
	- You can create a CloudWatch metric and associate a CloudWatch alarm, then create a Health Check that checks the alarm itself to work around this limitation
![[7.4 Private Zone Health Checks.png]]
# Route 53 - Third Party Domains
- Domain Registrar vs DNS Service
	- You buy or register your domain name with a Domain Registrar typically by paying annual charges (e.g. GoDaddy, Amazon Registrar Inc. etc.)
	- The Domain Registrar usually provides you with a DNS service to manage your DNS records
	- But you can use another DNS service to manage your DNS records
	- Example: Purchase the domain from GoDaddy and use Route53 to manage your DNS records.
- If you buy your domain on a third party registrar you can still use Route 53 as the DNS service provider
# Routing Policy - Simple
- Route traffic to a single resource
- Can specify multiple values in the same record
- If multiple values are returned, the client chooses one at random
- When alias is enabled, specify only one AWS resource
- Can't be associated with Health Checks
![[7.5 Simple Routing.png]]
# Routing Policy - Weighted
- Control the % of requests that go to each specific resource
- Assign each record a relative weight
- DNS records must have the same name and type
- Can be associated with Health Checks
- Use cases: load balancing between regions, testing new application versions
- Assign a weight of 0 to a record to stop sending traffic to that resource
- If all records have 0 weight then all records will be returned equally
![[7.6 Weighted Routing.png]]
# Routing Policy - Latency
- Redirect traffic to the resource that has the least latency relative to the client
- Latency is based on traffic between users and AWS regions
- Germany users might be directed to the US if that is the lowest latency available
- Can be associated with Health Checks and failover
![[7.7 Latency Routing.png]]
# Routing Policy - Geolocation
- Generally similar to Latency based but notably distinct
- Routing based strictly on geolocation of client
- Latency is not considered
- Can scope to continent, country, or US state
- Should create a default record in case there's no location found
- Useful for regional content restriction, localisation etc.
- Can be associated with Health Checks
# Routing Policy - Geoproximity
- Basically Geolocation Routing but with the ability to add bias values to geographic regions. So you can control precisely how popular specific regions are. Resources can be AWS (specify AWS region) or non-AWS (specify latitude and longitude)
- You must use Route 53 Traffic Flow (advanced) to use this feature
![[7.X Geoproximity Routing.png]]
# Routing Policy - IP Based
- Routing based on client IP address
- You provide a list of CIDRs for your clients and the corresponding endpoints / locations (User IP to endpoint mappings)
- Useful for performance optimisation, reducing network costs etc.
- Example: Route users from a specific ISP to a specific endpoint
# Routing Policy - Failover
![[7.X Routing Failover.png]]
# Routing Policy - Multi Value
- Use when routing traffic to multiple resources
- Can be associated with Health Checks
- Up to 8 healthy records are returned for each Multi-Value query
- Not a substitute for a Load Balancer