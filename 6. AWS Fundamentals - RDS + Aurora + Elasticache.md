# Amazon RDS Overview
RDS Stands for Relational Database Service. Amazon RDS is a managed DB service for SQL DBs. The following databases are supported:
- Postgres
- MySQL
- MariaDB
- Orcale
- Microsoft SQL Server
- Aurora (Proprietary AWS DB)
RDS is a managed service, which means Amazon provides the following features out-of-the-box:
- Automated provisioning
- OS patching
- Rolling backups
- Point-in-time restore
- Monitoring dashboards
- Read replicas
- Multi-AZ DR setup
- Maintenance windows
- Scaling capability
- EBS-backed storage (using gp2 or io1 volumes)
However, you cannot SSH into RDS instances.
## RDS Storage Auto Scaling
RDS Storage Auto Scaling allows the available storage space in an RDS DB instance to be automatically scaled up or down depending on demand. It is dependent on the **Maximum Storage Threshold** value. For example, it can automatically modify storage if:
- Free storage is less that 10% of allocated storage
- Low-storage lasts at least 5 minutes
- 6 hours have passed since last modification
Useful for applications with unpredictable workloads, and has support for all RDS DB engines (see above).
# RDS Read Replicas vs Multi AZ
## Read Replicas
- Allows up to 15 Read Replicas
- RRs can be within AZ, Cross AZ, or Cross Region
- Replication is ASYNC, so reads are **eventually** consistent
- Replicas can be promoted to their own master DBs
![[6.1 RDS Read Replicas.png]]
## Read Replicas - Use Cases
- You have a production database that is taking on normal load
- You want to run a reporting application to run some analytics
- You create a Read Replica to run the new workload there
- The production application is unaffected
## Read Replicas - Network Cost
- In AWS there's a network cost when data goes from one AZ to another
- For RDS Read Replicas within the same region, you don't pay that fee
## RDS Multi AZ
- SYNC replication
- One DNS name - automatic app failover to standby
- Increases availability
- Failover in case of AZ loss, network loss, or instance / storage failure
- No manual intervention in apps
- Not used for scaling
![[6.2 RDS Multi AZ Disaster Recovery.png]]
## RDS From Single AZ to Multi AZ
- Zero downtime operation (No need to stop DB)
- Snapshot is taken
- New DB is restored from the snapshot in new AZ
- Synchronisation is established between the two databases
![[6.3 RDS Single AZ to Multi AZ.png]]
# RDS Custom for Oracle and Microsoft SQL Server
- A Managed Oracle and Microsoft SQL Server Database with OS and database customisation options
- RDS: Automates setup, operation, and scaling of AWS DB
- Custom: Access to the underlying database and OS so you can:
	- Configure settings
	- Install patches
	- Enable native features
	- Access the underlying EC2 Instance using SSH or SSM Session Manager
- Deactivate Automation Mode to perform your customisation, better to take a DB snapshot before
- RDS vs RDS Custom
	- RDS: Entire database and the OS to be managed by AWS
	- RDS Custom: Full admin access to the underlying OS and the database
# Amazon Aurora
- Aurora is a proprietary technology from AWS. It supports Postgres and MySQL as if they were Aurora DBs. 
- Aurora is "AWS Cloud Optimised" and claims a x5 performance improvement over MySQL on RDS, over x3 the performance of Postgres on RDS.
- Aurora Storage automatically grows in increments of 10GiB, up to 128TiB.
- Aurora can have up to 15 replicas and the replication process is faster than MySQL (<10ms replica lag)
- Failover in Aurora is instantaneous
- Aurora costs 20% more than RDS
## Aurora High Availability and Read Scaling
- 6 copies of your data across 3 AZs
	- 4 copies needed for writes
	- 3 copies needed for reads
	- Self-healing with P2P replication
	- Storage is striped across 100s of volumes
- On Aurora instance takes writes (master)
- Automated failover for master in less that 30 seconds
- Master and up to 15 Aurora Read Replicas serve read requests
- Supports Cross-Region replication
![[6.4 Aurora Read Replicas.png]]
![[6.5 Aurora DB Cluster.png]]
## Aurora Features
- Automatic failover
- Backup and recovery
- Isolation and security
- Industry compliance
- Push-button scaling
- Automated patching with zero downtime
- Advanced monitoring
- Routine maintenance
- Backtrack (Restore data at any point in time without using backups)
# Amazon Aurora - Advanced Concepts
## Aurora Replicas - Auto Scaling
![[6.6 Aurora Replicas - Auto Scaling.png]]
## Custom Endpoints
- You can define a subset of Aurora instances as a custom endpoint
- For example: Run analytical queries on specific replicas
- The Reader Endpoint is generally not used after defining Custom Endpoints
![[6.7 Aurora Custom Endpoints.png]]
## Aurora Serverless
- Automated database instantiation and auto-scaling based on actual usage
- Good for infrequent, intermittent or unpredictable workloads
- No capacity planning needed
- Pay-per-second
![[6.8 Aurora Serverless.png]]
## Global Aurora
- Aurora Cross-Region Read Replicas
	- Useful for disaster recovery
	- Simple to put in place
- Aurora Global Database
	- 1 primary region for read and write
	- Up to 5 secondary read-only regions with <1s replication lag
	- Up to 16 Read Replicas per secondary region
	- Helps for decreasing latency
	- Promoting another region has a <1m RTO
	- Typical cross-region replication takes <1s
![[6.9 Global Aurora.png]]
## Aurora Machine Learning
- Enables you to add ML-based predictions to your applications via SQL
- Simple, optimised, and secure integration between Aurora and AWS ML services
- Supported services include:
	- Amazon SageMaker
	- Amazon Comprehend
- No ML experience needed
- Useful for fraud detection, ads targeting, sentiment analysis, product recommendations etc.
![[6.10 Aurora Machine Learning.png]]
# RDS & Aurora - Backup and Monitoring
## RDS Backups
- Automated backups
	- Daily full backup of DB during backup window
	- Transaction logs are backed-up by RDS every 5 mins
	- Ability to restore to any point in time
	- 1 to 35 days of retention, set 0 to disable automated backups
- Manual DB Snapshots
	- Manually triggered by user
	- Indefinite retention duration
- In a stopped RDS DB you still have to pay for storage. If you plan on stopping your DB for long-term, snapshot and restore instead
## Aurora Backups
- Automated backups
	- 1 to 35 days (cannot be disabled)
	- Point-in-time recovery between 1 to 35 days ago
- Manual DB snapshots
	- Manually triggered by user
	- Indefinite retention duration
## Restore Options
- Restoring an RDS / Aurora backup or snapshot creates a new database
- Restoring MySQL RDS from S3
	- Create a backup of your on-premises DB
	- Store it on Amazon S3
	- Restore the backup file onto a new RDS instance running MySQL
- Restoring MySQL Aurora cluster from S3
	- Create a backup of your on-premises database using Percona XtraBackup
	- Store the backup file on Amazon S3
	- Restore the backup file onto a new Aurora cluster running MySQL
## Database Cloning
- Creates a new Aurora DB cluster from an existing one
- Faster than Snapshot-Restore
- Uses copy-on-write protocol
	- Initially, the new DB cluster uses the same data volume as the original DB cluster (fast and efficient, no copying is needed)
	- When updates are made to the new DB cluster data, then additional storage is allocated and data is copied to be separated
- Very fast and cost-effective
- Useful to create a "staging" database from a "production" database without impacting said DB
# RDS Security
- At-rest encryption
	- Database master & replicas encryption using AWS MKS - must be defined as launch time
	- If the master is not encrypted, the read replicas cannot be encrypted
	- To encrypt an un-encrypted database, go through a DB snapshot and restore as encrypted
- In-flight encryption: TLS-ready by default, use the AWS TLS root certificates client-side
- IAM Authentication: IAM roles to connect to your database (instead of username / password)
- Security Groups: Control network access to your RDS / Aurora DB
- No SSH available except on RDS Custom
- Audit Logs can be enabled and sent to CloudWatch Logs for longer retention
# RDS Proxy
- Fully managed database proxy for RDS
- Allows apps to pool and share DB connections established with the database
- Improving database efficiency by reducing the stress on database resources (e.g. CPU, RAM) and minimise open connections and timeouts
- Serverless, autoscaling, highly available (Multi-AZ)
- Reduced RDS and Aurora failover time by up to 66%
- Supports RDS and Aurora
- No code changes required for most apps
- Enforces IAM Authentication for DB, and securely stores credentials in AWS Secrets Manager
- RDS Proxy is never publicly accessible and must be accessed from VPC
![[6.11 RDS Proxy.png]]
# ElastiCache Overview
RDS is to Relational Databases as ElastiCache is to Managed Redis or Memcached. Caches are in-memory databases with high performance and low latency. This helps reduce load on databases for read intensive workloads and to make your application stateless.
AWS takes care of OS maintenance, patching, optimisations, setup, configuration, monitoring, failure recovery, and backups, but using ElastiCache requires heavy application code changes.
## ElastiCache - DB Cache
- Application queries ElastiCache, if not available, it queries RDS and writes the result to cache.
- Cache must have an invalidation strategy to make sure only the most current data is used there.
![[6.12 ElastiCache DB Cache.png]]
## ElastiCache - User Session Store
- User logs into any application instance
- The application writes the session data into ElastiCache
- The user hits another instance of our application
- The new instance retrieves the data and the user is already logged in
![[6.13 ElastiCache User Session Store.png]]
## Redis vs Memcached
- Redis
	- Multi AZ with auto-failover
	- Read replicas to scale reads and have high availability
	- Data durability using AOF persistence
	- Backup and restore features
	- Supports sets and sorted sets
- Memcached
	- Multi-nod for partitioning of data (sharding)
	- No high availability or replication
	- Non persistent
	- No backup and restore
	- Multi-threaded architecture
# ElastiCache for Solutions Architects
## ElastiCache Security
- ElastiCache supports IAM Authentication for Redis
- IAM policies on ElastiCache are only used for AWS API-level security
- Redis Auth
	- You can set a password / token when you create a Redis cluster
	- This is an extra level of security for your cache (on top of security groups)
	- Supports SSL in-flight encryption
- Memcached
	- Supports SASL-based authentication (advanced)
## Patterns for ElastiCache
- Lazy Loading
	- All the read data is cached, data can become stale in cache
- Write Through
	- Adds or updates data in the cache when written to a DB
- Session Store
	- Store temporary session data in a cache using TTL features
# Important Ports